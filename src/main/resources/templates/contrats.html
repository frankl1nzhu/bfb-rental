<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Liste des contrats</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <a href="/" class="btn btn-secondary mb-3">â† Retour Ã  l'accueil</a>
        
        <div class="alert alert-danger" th:if="${param.error}">
            Ã‰chec de l'opÃ©ration : conflit d'horaire ou donnÃ©es insuffisantes.
        </div>

        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2>ğŸ“ Suivi des contrats</h2>
            <div>
                <a href="/ui/contrats/scenario/retard" class="btn btn-danger me-2">ğŸ”¥ GÃ©nÃ©rer un scÃ©nario de conflit (dÃ©mo)</a>
                <a href="/ui/contrats/random" class="btn btn-warning me-2">ğŸ² GÃ©nÃ©rer un contrat alÃ©atoire</a>
                <a href="/ui/contrats/new" class="btn btn-primary">+ Nouveau contrat</a>
            </div>
        </div>

        <table class="table table-bordered shadow-sm">
            <thead class="table-dark">
                <tr>
                    <th>ID</th>
                    <th>Client</th>
                    <th>VÃ©hicule</th>
                    <th>PÃ©riode</th>
                    <th>Ã‰tat</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="c : ${contrats}">
                    <td th:text="${c.id}"></td>
                    <td th:text="${c.client.nom + ' ' + c.client.prenom}"></td>
                    <td th:text="${c.vehicule.marque + ' (' + c.vehicule.immatriculation + ')'}"></td>
                    <td th:text="${c.dateDebut + ' â” ' + c.dateFin}"></td>
                    <td>
                        <span th:text="${c.etat}" class="badge bg-secondary"></span>
                    </td>
                    <td>
                        <a th:href="@{/ui/contrats/edit/{id}(id=${c.id})}" 
                           class="btn btn-sm btn-outline-primary">âœï¸ Modifier</a>
                        <a th:if="${c.etat.name() == 'EN_COURS' or c.etat.name() == 'EN_RETARD'}"
                            th:href="@{/ui/contrats/terminer/{id}(id=${c.id})}"
                            class="btn btn-sm btn-success"
                            onclick="return confirm('Confirmer le retour du vÃ©hicule et terminer le contrat ?')">ğŸ Terminer</a>

                        <a th:if="${c.etat.name() == 'EN_COURS'}" 
                           th:href="@{/ui/contrats/retard/{id}(id=${c.id})}" 
                           class="btn btn-sm btn-warning">â³ Retard</a>
                           
                        <a th:href="@{/ui/contrats/delete/{id}(id=${c.id})}" 
                           class="btn btn-sm btn-danger" 
                           onclick="return confirm('Confirmer la suppression ?')">ğŸ—‘ï¸ Supprimer</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</body>
</html>